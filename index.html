<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Suburbia Digital Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.5s ease;
        }
        body::before {
            content: '';
            position: fixed;
            bottom: -120px;
            right: -120px;
            width: 480px;
            height: 480px;
            background-image: url('https://github.com/BOICHlK/Suburbia/blob/main/City.png?raw=true');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.2;
            z-index: -1;
            transition: opacity 0.5s ease;
        }
        .theme-red { --theme-color: #E53E3E; --theme-color-light: #f58282; }
        .theme-yellow { --theme-color: #D69E2E; --theme-color-light: #e6b45e; }
        .theme-teal { --theme-color: #38B2AC; --theme-color-light: #68d2ce; }
        .theme-gray { --theme-color: #A0AEC0; --theme-color-light: #cbd5e0; }
        .theme-purple { --theme-color: #805AD5; --theme-color-light: #a07de5; }

        .bg-theme { background-color: var(--theme-color); }
        .text-theme { color: var(--theme-color); }
        .border-theme { border-color: var(--theme-color); }
        .shadow-theme-glow { box-shadow: 0 0 15px var(--theme-color); }
        
        .color-selector button.active {
            transform: scale(1.15);
            box-shadow: 0 0 15px var(--theme-color);
            border: 2px solid var(--theme-color-light);
        }
        .counter { transition: color 0.3s ease; }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }

        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); }
        .modal-leave { opacity: 1; transform: scale(1); }
        .modal-leave-active { opacity: 0; transform: scale(0.95); }
    </style>
</head>
<body id="body-container" class="bg-[#1a202c] text-white overflow-hidden h-screen flex items-center justify-center select-none">

    <div id="app-container" class="w-full max-w-md mx-auto h-full p-4 flex flex-col">
        
        <header class="flex-shrink-0 text-center mb-4">
            <h1 class="font-extrabold text-4xl tracking-tight text-theme transition-colors duration-300">SUBURBIA</h1>
            <div class="mt-3 flex justify-center items-center space-x-3 color-selector">
                <button data-color="red" class="w-8 h-8 rounded-full bg-[#E53E3E] transition-all duration-300"></button>
                <button data-color="yellow" class="w-8 h-8 rounded-full bg-[#D69E2E] transition-all duration-300"></button>
                <button data-color="teal" class="w-8 h-8 rounded-full bg-[#38B2AC] transition-all duration-300"></button>
                <button data-color="gray" class="w-8 h-8 rounded-full bg-[#A0AEC0] transition-all duration-300"></button>
                <button data-color="purple" class="w-8 h-8 rounded-full bg-[#805AD5] transition-all duration-300"></button>
            </div>
        </header>

        <main class="flex-grow flex flex-col gap-3">
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-black/20 backdrop-blur-sm rounded-2xl p-3 flex flex-col items-center justify-center shadow-lg">
                    <span class="text-4xl">üìà</span>
                    <span class="text-gray-300 text-sm mt-1">Income</span>
                    <div class="flex items-center space-x-3 mt-2">
                        <button data-stat="income" data-amount="-1" class="bg-white/10 w-9 h-9 rounded-full text-2xl flex items-center justify-center transition active:scale-90">-</button>
                        <span id="income-value" class="text-3xl font-bold w-14 text-center counter">0</span>
                        <button data-stat="income" data-amount="1" class="bg-white/10 w-9 h-9 rounded-full text-2xl flex items-center justify-center transition active:scale-90">+</button>
                    </div>
                </div>
                <div class="bg-black/20 backdrop-blur-sm rounded-2xl p-3 flex flex-col items-center justify-center shadow-lg">
                    <span class="text-4xl">‚≠ê</span>
                    <span class="text-gray-300 text-sm mt-1">Reputation</span>
                    <div class="flex items-center space-x-3 mt-2">
                        <button data-stat="reputation" data-amount="-1" class="bg-white/10 w-9 h-9 rounded-full text-2xl flex items-center justify-center transition active:scale-90">-</button>
                        <span id="reputation-value" class="text-3xl font-bold w-14 text-center counter">1</span>
                        <button data-stat="reputation" data-amount="1" class="bg-white/10 w-9 h-9 rounded-full text-2xl flex items-center justify-center transition active:scale-90">+</button>
                    </div>
                </div>
            </div>
            <div class="bg-black/20 backdrop-blur-sm rounded-2xl p-4 flex flex-col justify-center shadow-lg">
                <div class="flex items-center justify-between">
                    <span class="text-4xl">üí∞</span>
                    <span id="money-value" class="text-5xl font-extrabold">15</span>
                </div>
                <div class="grid grid-cols-6 gap-2 mt-3">
                    <button data-stat="money" data-amount="-5" class="bg-white/10 h-9 rounded-lg transition active:scale-90 text-red-400">-5</button>
                    <button data-stat="money" data-amount="-3" class="bg-white/10 h-9 rounded-lg transition active:scale-90 text-red-400">-3</button>
                    <button data-stat="money" data-amount="-1" class="bg-white/10 h-9 rounded-lg transition active:scale-90 text-red-400">-1</button>
                    <button data-stat="money" data-amount="1" class="bg-white/10 h-9 rounded-lg transition active:scale-90 text-green-400">+1</button>
                    <button data-stat="money" data-amount="3" class="bg-white/10 h-9 rounded-lg transition active:scale-90 text-green-400">+3</button>
                    <button data-stat="money" data-amount="5" class="bg-white/10 h-9 rounded-lg transition active:scale-90 text-green-400">+5</button>
                </div>
            </div>
            <div class="bg-black/20 backdrop-blur-sm rounded-2xl p-4 flex items-center justify-between shadow-lg">
                <span class="text-4xl">üë•</span>
                <input id="population-input" type="number" class="bg-transparent text-5xl font-extrabold w-32 text-right focus:outline-none border-b-2 border-transparent focus:border-theme transition-colors duration-300" value="2">
            </div>
        </main>

        <footer class="flex-shrink-0 mt-3 space-y-3">
            <div class="grid grid-cols-4 gap-3">
                <button id="new-game-btn" class="w-full bg-white/10 rounded-xl py-4 font-bold transition active:scale-95 text-lg">–ù–æ–≤–∞</button>
                <button id="history-btn" class="w-full bg-white/10 rounded-xl py-4 font-bold transition active:scale-95 text-3xl">üìú</button>
                <button id="end-turn-btn" class="w-full bg-theme rounded-xl py-4 font-bold transition active:scale-95 shadow-lg shadow-theme-glow col-span-2">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –•—ñ–¥</button>
            </div>
            <div id="log-container" class="h-6 text-center text-sm text-gray-300 transition-opacity duration-500 opacity-0"></div>
        </footer>
    </div>

    <div id="history-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 hidden transition-all duration-300 modal-enter">
        <div id="history-modal-content" class="bg-[#2d3748] rounded-2xl w-full max-w-md shadow-2xl flex flex-col transition-colors duration-500">
            <header class="p-4 flex justify-between items-center border-b border-white/10">
                <h2 class="text-2xl font-bold text-theme">–Ü—Å—Ç–æ—Ä—ñ—è —Ö–æ–¥—ñ–≤</h2>
                <button id="close-history-btn" class="bg-white/10 w-8 h-8 rounded-full text-xl flex items-center justify-center transition active:scale-90">&times;</button>
            </header>
            <div id="history-log-content" class="p-4 space-y-4 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
        const state = { income: 0, reputation: 1, money: 15, population: 2, playerColor: 'teal', log: [[]], turnCounter: 1, turnMoneyDelta: 0, currentLogMessage: '' };

        const MIN_STAT = -5;
        const MAX_STAT = 15;
        const RED_LINE_THRESHOLDS = [16, 22, 29, 35, 41, 47, 53, 59, 64, 69, 74, 78, 82, 86, 89, 92, 95, 98, 101, 103, 105, 107, 109, 111, 113, 115, 117, 119, 121, 123, 125, 127, 129, 131, 133, 135, 137, 139, 141, 143, 145, 147, 149, 151, 153, 155, 157, 159];
        const THEMES = { 
            red:    { class: 'theme-red',    bg: '#281e1e', modalBg: '#3b2626' },
            yellow: { class: 'theme-yellow', bg: '#2d2a1e', modalBg: '#3d3826' },
            teal:   { class: 'theme-teal',   bg: '#1e2d2d', modalBg: '#263d3d' },
            gray:   { class: 'theme-gray',   bg: '#2c3136', modalBg: '#3c434a' },
            purple: { class: 'theme-purple', bg: '#281e2d', modalBg: '#3a263d' }
        };

        const el = {
            body: document.getElementById('body-container'),
            app: document.getElementById('app-container'),
            income: document.getElementById('income-value'),
            reputation: document.getElementById('reputation-value'),
            money: document.getElementById('money-value'),
            population: document.getElementById('population-input'),
            log: document.getElementById('log-container'),
            controlButtons: document.querySelectorAll('button[data-stat]'),
            colorButtons: document.querySelectorAll('.color-selector button'),
            newGameBtn: document.getElementById('new-game-btn'),
            endTurnBtn: document.getElementById('end-turn-btn'),
            historyBtn: document.getElementById('history-btn'),
            historyModal: document.getElementById('history-modal'),
            historyModalContent: document.getElementById('history-modal-content'),
            closeHistoryBtn: document.getElementById('close-history-btn'),
            historyLogContent: document.getElementById('history-log-content'),
        };

        let logTimeout;

        function addToLog(message, type) {
            state.log[0].unshift({ message, type, time: new Date().toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' }) });
            state.currentLogMessage = message;
        }

        function updateUI() {
            el.income.textContent = state.income;
            el.reputation.textContent = state.reputation;
            el.money.textContent = state.money;
            el.population.value = state.population;

            el.income.className = `text-3xl font-bold w-14 text-center counter ${state.income > 0 ? 'text-green-400' : state.income < 0 ? 'text-red-400' : 'text-white'}`;
            el.reputation.className = `text-3xl font-bold w-14 text-center counter ${state.reputation > 0 ? 'text-blue-400' : state.reputation < 0 ? 'text-red-400' : 'text-white'}`;
            
            el.controlButtons.forEach(button => {
                const stat = button.dataset.stat;
                const amount = parseInt(button.dataset.amount);
                if (stat === 'income' || stat === 'reputation') {
                    const value = state[stat];
                    button.disabled = (value >= MAX_STAT && amount > 0) || (value <= MIN_STAT && amount < 0);
                    button.classList.toggle('opacity-25', button.disabled);
                }
            });

            const theme = THEMES[state.playerColor];
            el.app.className = `w-full max-w-md mx-auto h-full p-4 flex flex-col ${theme.class}`;
            el.body.style.backgroundColor = theme.bg;
            el.historyModalContent.style.backgroundColor = theme.modalBg;

            if (state.currentLogMessage) {
                clearTimeout(logTimeout);
                el.log.textContent = state.currentLogMessage;
                el.log.style.opacity = '1';
                logTimeout = setTimeout(() => { 
                    el.log.style.opacity = '0';
                    state.currentLogMessage = '';
                }, 3000);
            }
        }
        
        function handleStatChange(stat, amount) {
            const oldValue = state[stat];
            let value = oldValue + amount;
            if (stat === 'income' || stat === 'reputation') {
                value = Math.max(MIN_STAT, Math.min(MAX_STAT, value));
            }
            if (stat === 'money') value = Math.max(0, value);
            
            if (oldValue !== value) {
                state[stat] = value;
                if (stat === 'money') {
                    state.turnMoneyDelta += amount;
                } else {
                    const sign = amount > 0 ? '+' : '';
                    const emoji = stat === 'income' ? 'üìà' : '‚≠ê';
                    const statName = stat === 'income' ? 'Income' : 'Reputation';
                    addToLog(`${emoji} ${statName} ${sign}${amount}`, stat);
                }
            }
            updateUI();
        }

        function checkRedLines(oldPopulation, newPopulation) {
            if (newPopulation === oldPopulation) return;
            let linesCrossed = 0;
            let message = '';
            if (newPopulation > oldPopulation) {
                linesCrossed = RED_LINE_THRESHOLDS.filter(line => line > oldPopulation && line <= newPopulation).length;
                if (linesCrossed > 0) {
                    state.income = Math.max(MIN_STAT, state.income - linesCrossed);
                    state.reputation = Math.max(MIN_STAT, state.reputation - linesCrossed);
                    message = `üö® –ß–µ—Ä–≤–æ–Ω–∞ –ª—ñ–Ω—ñ—è! (-${linesCrossed} üìà/‚≠ê)`;
                }
            } else {
                linesCrossed = RED_LINE_THRESHOLDS.filter(line => line <= oldPopulation && line > newPopulation).length;
                if (linesCrossed > 0) {
                    state.income = Math.min(MAX_STAT, state.income + linesCrossed);
                    state.reputation = Math.min(MAX_STAT, state.reputation + linesCrossed);
                    message = `‚úÖ –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è (+${linesCrossed} üìà/‚≠ê)`;
                }
            }
            if(message) addToLog(message, 'system');
        }

        function handlePopulationChange() {
            const newPopulation = parseInt(el.population.value) || 0;
            const oldPopulation = state.population;
            checkRedLines(oldPopulation, newPopulation);
            state.population = newPopulation;
            updateUI();
        }

        function handleEndTurn() {
            if (state.turnMoneyDelta !== 0) {
                const sign = state.turnMoneyDelta > 0 ? '+' : '';
                addToLog(`üí∞ –í–∏—Ç—Ä–∞—Ç–∏/–ü—Ä–∏–±—É—Ç–æ–∫: ${sign}${state.turnMoneyDelta}`, 'money');
                state.turnMoneyDelta = 0;
            }

            const oldPopulation = state.population;
            
            if (state.income !== 0) {
                state.money += state.income;
                const sign = state.income > 0 ? '+' : '';
                addToLog(`üìà Income: ${sign}${state.income}`, 'income');
            }
            if (state.money < 0) {
                const debt = Math.abs(state.money);
                state.money = 0;
                state.population = Math.max(0, state.population - debt);
                addToLog(`üìâ –ë–æ—Ä–≥! -${debt} üë•`, 'system');
            }

            if (state.reputation !== 0) {
                const populationBeforeRep = state.population;
                state.population = Math.max(0, state.population + state.reputation);
                const sign = state.reputation > 0 ? '+' : '';
                addToLog(`‚≠ê Reputation: ${sign}${state.reputation} üë•`, 'reputation');

                if (state.reputation < 0) {
                    const populationLost = populationBeforeRep - state.population;
                    const moneyToPay = Math.abs(state.reputation) - populationLost;
                    if (moneyToPay > 0) {
                        state.money = Math.max(0, state.money - moneyToPay);
                        addToLog(`üí∞ –®—Ç—Ä–∞—Ñ: -${moneyToPay}`, 'money');
                    }
                }
            }
            
            const newPopulation = state.population;
            checkRedLines(oldPopulation, newPopulation);
            
            addToLog(`üèÅ –•—ñ–¥ ${state.turnCounter} –∑–∞–≤–µ—Ä—à–µ–Ω–æ`, 'system');
            state.turnCounter++;
            state.log.unshift([]);
            updateUI();
        }

        function handleNewGame() {
            state.income = 0;
            state.reputation = 1;
            state.money = 15;
            state.population = 2;
            state.log = [[]];
            state.turnCounter = 1;
            state.turnMoneyDelta = 0;
            addToLog('üöÄ –ù–æ–≤—É –≥—Ä—É —Ä–æ–∑–ø–æ—á–∞—Ç–æ!', 'system');
            updateUI();
        }

        function handleColorChange(color) {
            state.playerColor = color;
            el.colorButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.color === color));
            updateUI();
        }

        function renderHistory() {
            el.historyLogContent.innerHTML = '';
            const turns = state.log.filter(turn => turn.length > 0);
            if (turns.length === 0) {
                el.historyLogContent.innerHTML = `<p class="text-gray-400 text-center">–Ü—Å—Ç–æ—Ä—ñ—è —Ö–æ–¥—ñ–≤ –ø–æ—Ä–æ–∂–Ω—è.</p>`;
                return;
            }
            turns.forEach((turn, index) => {
                const turnNumber = state.turnCounter - index - 1;
                const turnContainer = document.createElement('div');
                turnContainer.className = 'bg-black/20 rounded-lg p-3';
                
                const turnHeader = document.createElement('h3');
                turnHeader.className = 'font-bold text-lg border-b border-white/10 pb-2 mb-2 text-theme';
                turnHeader.textContent = `–•—ñ–¥ ‚Ññ${turnNumber}`;
                turnContainer.appendChild(turnHeader);

                const entriesContainer = document.createElement('div');
                entriesContainer.className = 'space-y-1';
                
                turn.slice().reverse().forEach(entry => {
                    const p = document.createElement('p');
                    p.className = 'text-sm';
                    p.innerHTML = `<span class="text-xs text-gray-400 mr-2">${entry.time}</span> ${entry.message}`;
                    entriesContainer.appendChild(p);
                });
                turnContainer.appendChild(entriesContainer);
                el.historyLogContent.appendChild(turnContainer);
            });
        }

        function showHistoryModal() {
            renderHistory();
            el.historyModal.classList.remove('hidden');
            setTimeout(() => el.historyModal.classList.remove('modal-enter'), 10);
        }

        function hideHistoryModal() {
            el.historyModal.classList.add('modal-leave', 'modal-leave-active');
            setTimeout(() => {
                el.historyModal.classList.add('hidden');
                el.historyModal.classList.remove('modal-leave', 'modal-leave-active', 'modal-enter');
            }, 300);
        }

        el.controlButtons.forEach(button => button.addEventListener('click', () => handleStatChange(button.dataset.stat, parseInt(button.dataset.amount))));
        el.population.addEventListener('change', handlePopulationChange);
        el.newGameBtn.addEventListener('click', handleNewGame);
        el.endTurnBtn.addEventListener('click', handleEndTurn);
        el.colorButtons.forEach(button => button.addEventListener('click', () => handleColorChange(button.dataset.color)));
        el.historyBtn.addEventListener('click', showHistoryModal);
        el.closeHistoryBtn.addEventListener('click', hideHistoryModal);
        el.historyModal.addEventListener('click', (e) => {
            if (e.target === el.historyModal) hideHistoryModal();
        });

        document.addEventListener('DOMContentLoaded', () => {
            handleColorChange('teal');
            handleNewGame();
        });
    </script>
</body>
</html>


